<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VOICEVOX Playground</title>
    <link rel="stylesheet" href="/src/styles.css" />
  </head>
  <body>
    <h1 class="sr-only">VOICEVOX Playground</h1>
    <div class="controls">
      <button id="usageToggleButton" class="secondary-button" aria-expanded="false" aria-controls="usagePanel">ℹ️ 利用方法</button>
    </div>
    
    <div class="container info" id="usagePanel" hidden>
      <h1 aria-hidden="true">🎙️ VOICEVOX Playground</h1>
      <p>GitHub Pages 版（<code>https://cat2151.github.io/voicevox-playground/</code>）からアクセスする際は、VOICEVOXエンジンを以下のコマンドで起動してCORSを許可してください。</p>
      <div class="code-block">
        <code>&lt;your VOICEVOX directory&gt;/vv-engine/run --cors_policy_mode all --allow_origin https://cat2151.github.io</code>
      </div>
      <p>ローカル開発サーバー（<code>http://localhost:5173</code>）も許可する場合は、上記コマンドに <code>http://localhost:5173</code> を追加してください。</p>
      <div class="code-block">
        <code>&lt;your VOICEVOX directory&gt;/vv-engine/run --cors_policy_mode all --allow_origin https://cat2151.github.io http://localhost:5173</code>
      </div>
      <p>話者やボイスをテキスト内で切り替えるときは、区切り文字欄に開始と終端を指定します（例: <code>[]</code> または <code>[ ]</code>）。空欄のままなら切り替えません。</p>
      <p>マーカーの中身は次の順で解釈します。</p>
      <ul>
        <li><code>[ずんだもん]</code> → 話者名に一致したらその話者の「ノーマル」を選択</li>
        <li><code>[ヒソヒソ]</code> → 現在の話者に同名のボイスがあればそちらへ切り替え</li>
        <li><code>[37]</code> → 数値はIDとして扱い、例では四国めたん ヒソヒソ</li>
      </ul>
      <p>開始/終端の組み合わせはスペース区切りで2つ書くか、<code>[]</code>のように1組をそのまま入力できます。</p>
    </div>

    <div class="container">
      <div class="style-row">
        <select id="styleSelect" aria-label="話者・ボイス選択"></select>
        <select id="speakerStyleSelect" aria-label="現在のキャラのスタイル選択"></select>
        <input
          id="delimiterInput"
          type="text"
          aria-label="切替区切り文字"
          placeholder="空欄のままなら切り替えなし"
        />
        <label for="randomStyleCheckbox" class="style-row__random-toggle">
          <input type="checkbox" id="randomStyleCheckbox" />
          ランダムstyle
        </label>
      </div>

      <div class="input-row">
        <textarea id="text" class="text-input" aria-label="テキスト入力">ずんだもんなのだ</textarea>
        <div class="visualizer__frame input-visualizer">
          <canvas id="realtimeWaveform" width="760" height="144" aria-label="リアルタイム波形"></canvas>
        </div>
      </div>
      
      <div class="controls">
        <button id="playButton" aria-label="Play" title="Play" data-icon="play">
          <svg class="icon icon--play" aria-hidden="true" viewBox="0 0 24 24" focusable="false">
            <path d="M7 5.5v13l11-6.5-11-6.5Z"></path>
          </svg>
        </button>
        <button id="exportButton" disabled>ダウンロード (Export WAV)</button>
        <label for="loopCheckbox" class="loop-control">
          <input type="checkbox" id="loopCheckbox" checked />
          ループ再生
        </label>
      </div>
      
      <div id="status" class="status" role="status" aria-live="polite"></div>
    </div>

    <div class="container">
      <div class="controls">
        <button
          id="favoritesToggleButton"
          class="secondary-button"
          aria-expanded="false"
          aria-controls="favoritesPanel"
        >★ お気に入り管理</button>
      </div>
      <div id="favoritesPanel" class="favorites-panel" hidden>
        <div class="favorites-section">
          <div class="favorites-section__title">イントネーション付きお気に入り</div>
          <ul id="intonationFavoritesList" class="text-list" aria-label="イントネーション付きお気に入り"></ul>
        </div>
        <div class="favorites-section">
          <div class="favorites-section__title">現在のお気に入り</div>
          <ul id="favoritesList" class="text-list" aria-label="現在のお気に入りのテキスト"></ul>
        </div>
        <div class="favorites-section">
          <div class="favorites-section__title">再生履歴</div>
          <ul id="historyList" class="text-list" aria-label="再生履歴のテキスト"></ul>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="intonation-area">
        <div class="controls">
          <button
            id="intonationKeyboardToggle"
            class="secondary-button"
            aria-pressed="false"
            aria-label="キーボード操作を有効/無効にする"
          >キーボード操作: OFF</button>
          <button
            id="intonationResetButton"
            class="secondary-button"
            type="button"
            aria-label="取得したイントネーションにリセットする"
          >リセット</button>
          <button
            id="intonationFavoriteButton"
            class="secondary-button"
            type="button"
          >お気に入りに登録</button>
        </div>
        <div class="intonation-canvas-wrapper">
          <div class="intonation-side">
            <div class="intonation-controls intonation-controls--top">
              <button id="intonationExpandTop" class="secondary-button intonation-controls__button" aria-label="上方向の幅を2倍">2x</button>
              <button id="intonationShrinkTop" class="secondary-button intonation-controls__button" aria-label="上方向の幅を1/2">0.5x</button>
            </div>
            <div class="intonation-range-value intonation-range-value--max" id="intonationMaxValue" aria-hidden="true"></div>
            <div class="intonation-range-value intonation-range-value--min" id="intonationMinValue" aria-hidden="true"></div>
            <div class="intonation-controls intonation-controls--bottom">
              <button id="intonationShrinkBottom" class="secondary-button intonation-controls__button" aria-label="下方向の幅を1/2">0.5x</button>
              <button id="intonationExpandBottom" class="secondary-button intonation-controls__button" aria-label="下方向の幅を2倍">2x</button>
            </div>
          </div>
          <div class="intonation-canvas-area">
            <canvas id="intonationCanvas" width="760" height="180" aria-label="イントネーションの折れ線グラフ" tabindex="0"></canvas>
          </div>
        </div>
        <div id="intonationLabels" class="intonation-labels" aria-hidden="true"></div>
      </div>
    </div>

    <div class="container">
      <div class="visualizer-grid">
        <div class="visualizer__frame">
          <canvas id="renderedWaveform" width="760" height="144" aria-label="レンダリング後の波形"></canvas>
          <div id="renderedWaveformProgress" class="playback-progress" aria-hidden="true"></div>
        </div>
        <div class="visualizer__frame">
          <canvas id="spectrogram" width="760" height="144" aria-label="スペクトログラム"></canvas>
          <div id="spectrogramProgress" class="playback-progress" aria-hidden="true"></div>
          <button id="spectrogramScaleToggle" class="visualizer__action" type="button">対数にする</button>
        </div>
      </div>
    </div>

    <div id="playConfirmDialog" class="modal" hidden>
      <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="playConfirmTitle">
        <div id="playConfirmTitle" class="modal__title">イントネーションを初期化してplayしますか？</div>
        <p class="modal__body">編集したイントネーションは元に戻ります。</p>
        <div class="modal__actions">
          <button id="playConfirmReset" type="button">イントネーションを初期化してplay</button>
          <button id="playConfirmCancel" type="button" class="secondary-button">playしない</button>
        </div>
      </div>
    </div>

    <a class="repo-link" href="https://github.com/cat2151/voicevox-playground" target="_blank" rel="noopener noreferrer" aria-label="GitHub: cat2151/voicevox-playground（新しいタブで開きます）">GitHub: cat2151/voicevox-playground</a>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
